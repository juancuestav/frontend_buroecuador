import{u as V,R as Q}from"./ReportePDF.ed2e9902.js";import{u as D,E as M,F as N}from"./FormularioReporte.8e2aaf0c.js";import{r as U,d as F,_ as O,a0 as T,o as A,Z as S,U as w,J as h,V as L,O as q,L as l,j as f,ac as j,P as y,a2 as H,Q as J,M as K,c as B,af as z}from"./index.6072a1b1.js";import{Q as Z}from"./QPage.2411b3e2.js";import{c as G}from"./configuracionColumnasUsuarios.a44152fe.js";import{c as W,I as X}from"./ItemMiReporte.3c23dbd3.js";import{E as Y}from"./EssentialTable.0effb8dc.js";import{u as x}from"./notificaciones.fe24470b.js";import{_ as ee}from"./plugin-vue_export-helper.21dcd24c.js";import"./ReportePreview.1ff9a466.js";import"./ContadorComponent.52769ba4.js";import"./QKnob.eae7adbe.js";import"./QCircularProgress.dce56917.js";import"./format.8ac60962.js";import"./TouchPan.e744ede7.js";import"./touch.9135741d.js";import"./selection.ec88bd7c.js";import"./logo.d1d9b491.js";import"./utils.c7760b0c.js";import"./date.3330acff.js";import"./entidadAuditable.9f5621ba.js";import"./Hidratable.166e9fe1.js";import"./QSelect.8fa0bc61.js";import"./QChip.2863bbd0.js";import"./QItem.159d8e83.js";import"./QMenu.6c964ac0.js";import"./position-engine.71479b28.js";import"./QExpansionItem.10361b70.js";import"./use-render-cache.3aae9b27.js";import"./QForm.7a1734b3.js";import"./QTooltip.0b1018fa.js";import"./TransacccionSimpleController.f4dc3690.js";import"./StatusEssentialLoading.d6258813.js";import"./use-quasar.52f58024.js";import"./QBadge.1ab9ad97.js";import"./QToolbarTitle.80dd577d.js";import"./_commonjsHelpers.8402d862.js";import"./EstadosComponent.69881137.js";import"./utils.508c826c.js";function oe(o,e){const t=U(),n=U([]),s=U(),c={refListadoSeleccionable:t,listadoSeleccionable:n,endpoint:e,limpiar:()=>{o.id=null,o.nombres=null,o.identificacion=null,s.value=null},seleccionar:i=>{var R;o.id=i.id,o.nombres=i.name+" "+((R=i.apellidos)!=null?R:""),s.value=i.identificacion,o.identificacion=i.identificacion}},r=D(c);return{refListadoSeleccionableUsuario:t,listadoUsuarios:n,listarUsuarios:()=>r.listar(s.value),limpiarUsuario:()=>c.limpiar(),seleccionarUsuario:i=>r.seleccionar(i),criterioBusquedaUsuario:s}}var re=F({components:{EssentialTable:Y,EssentialSelectableTable:M},setup(){const o=U([]),e=O({id:null,nombres:null,identificacion:null}),t=T.getInstance(),{notificarAdvertencia:n,notificarCorrecto:s,confirmar:c}=x(),r=V();async function b(){const u="?usuario="+e.id,p=t.getEndpoint(S.reportes)+u,m=(await t.get(p)).data.results;m.length===0&&n("El usuario seleccionado no tiene reportes asignados");const E=[];for(let d=0;d<m.length;d++){const g=new X;g.id=m[d].id,g.nombre="REPORTE "+m[d].cliente+"-"+m[d].id,g.fecha=m[d].fecha,E.push(g)}o.value=[...E],r.setReportesConsultados(E)}const{refListadoSeleccionableUsuario:a,criterioBusquedaUsuario:v,listadoUsuarios:i,listarUsuarios:R,limpiarUsuario:I,seleccionarUsuario:P}=oe(e,"usuarios");async function $({entidad:u}){try{const p=await t.get(t.getEndpoint(S.reportes)+"/"+u.id);r.reporte=JSON.parse(p.data.reporte.reporte),r.mostrarEditarReporteConsultar(),r.cliente=e,r.idReporteActual=u.id}catch{console.log("error")}}function k({entidad:u,posicion:p}){c("\xBFDesea continuar?",async()=>{try{const C=await t.delete(t.getEndpoint(S.reportes)+"/"+u.id);s(C.data.mensaje),o.value.splice(p,1)}catch{}})}return A(()=>{o.value=r.reportesConsultados,r.cliente&&(e.id=r.cliente.id,e.nombres=r.cliente.nombres,v.value=r.cliente.identificacion)}),{configuracionColumnasUsuarios:G,configuracionColumnasMiReporte:W,listado:o,cliente:e,obtenerListado:b,editarReporte:$,eliminarReporte:k,refListadoSeleccionableUsuario:a,criterioBusquedaUsuario:v,listadoUsuarios:i,listarUsuarios:R,limpiarUsuario:I,seleccionarUsuario:P}}});const te={class:"row q-col-gutter-sm q-mb-xl"},ie={class:"col-12 col-md-3"},se={class:"col-12 col-md-9"},ae={class:"row"},ne={class:"col-12"};function le(o,e,t,n,s,c){const r=w("essential-table"),b=w("essential-selectable-table");return h(),L(Z,{padding:""},{default:q(()=>[l("div",te,[l("div",ie,[e[4]||(e[4]=l("label",{class:"block q-mb-sm"},"Identificaci\xF3n del cliente",-1)),f(y,{modelValue:o.criterioBusquedaUsuario,"onUpdate:modelValue":e[0]||(e[0]=a=>o.criterioBusquedaUsuario=a),placeholder:"Obligatorio",hint:"Ingrese identificaci\xF3n del cliente y luego presione la tecla Enter",onKeydown:e[1]||(e[1]=j(a=>o.listarUsuarios(),["enter"])),outlined:"",dense:""},null,8,["modelValue"])]),l("div",se,[e[6]||(e[6]=l("label",{class:"block q-mb-sm"},"Cliente seleccionado",-1)),f(y,{modelValue:o.cliente.nombres,"onUpdate:modelValue":e[3]||(e[3]=a=>o.cliente.nombres=a),outlined:"",dense:"",disable:""},{after:q(()=>[f(H,{color:"primary",onClick:e[2]||(e[2]=a=>o.obtenerListado()),class:"block full-width","no-caps":"",push:""},{default:q(()=>[f(J,{name:"bi-search",class:"q-mr-md",size:"xs"}),e[5]||(e[5]=K(" Listar reportes "))]),_:1})]),_:1},8,["modelValue"])])]),l("div",ae,[l("div",ne,[f(r,{configuracionColumnas:o.configuracionColumnasMiReporte,datos:o.listado,mostrarBotones:!1,mostrarHeader:!1,mostrarFooter:!1,permitirConsultar:!1,onEditar:o.editarReporte,onEliminar:o.eliminarReporte},null,8,["configuracionColumnas","datos","onEditar","onEliminar"])])]),f(b,{ref:"refListadoSeleccionableUsuario","configuracion-columnas":o.configuracionColumnasUsuarios,datos:o.listadoUsuarios,onSelected:o.seleccionarUsuario},null,8,["configuracion-columnas","datos","onSelected"])]),_:1})}var _=ee(re,[["render",le]]);const Ze=F({__name:"ConsultarReportePage",setup(o){const e=V();e.resetReporte();const t=B(()=>{switch(e.formularioConsultarReporte){case"FormularioReporte":return N;case"ConsultarReporte":return _;case"ReportePDF":return Q;default:return _}}),n=B(()=>["FormularioReporte","ReportePDF"].includes(e.formularioConsultarReporte));return(s,c)=>(h(),L(z(t.value),{"permitir-editar":n.value},null,8,["permitir-editar"]))}});export{Ze as default};
